<%= render file: "_search" %>

<table class="index">
  <thead>
    <tr>
      <th class="checkbox"><input type="checkbox" /></th>
      <% @model.fields.select {|k, v| k =~ /^(name|filename)/ }.keys.each do |key| %>
      <th><%= @model.t key %></th>
      <% end %>
      <th class=""><%= @model.t :color %></th>
      <th class="datetime"><%= @model.t :updated %></th>
    </tr>
  </thead>

  <tbody>
    <% @items.each do |item| %>
    <tr>
      <td class="checkbox">
        <input type="checkbox" name="ids[]" value="<%= item.id %>" />
        <nav class="tap-menu">
          <%= link_to :show, schedule_category_path(@cur_org, item) if item.allowed?(:read, @cur_user, @cur_group) %>
          <%= link_to :edit, edit_schedule_category_path(@cur_org, item) if item.allowed?(:edit, @cur_user, @cur_group) %>
          <%= link_to :delete, delete_schedule_category_path(@cur_org, item) if item.allowed?(:delete, @cur_user, @cur_group) %>
        </nav>
      </td>
      <% @model.fields.select {|k, v| k =~ /^(name|filename)/ }.keys.each_with_index do |key, idx| %>
        <% if idx == 0 %>
        <td><%= link_to item.send(key), action: :show, id: item %></td>
        <% elsif item.send(key).instance_of?(DateTime) %>
        <td><%= item.send(key).strftime("%Y/%m/%d %H:%M") %></td>
        <% elsif key == "filename" %>
        <td><%= File.basename item.send(key) %></td>
        <% else %>
        <td><%= item.send(key) %></td>
        <% end %>
      <% end %>
      <td><%= item.color %></td>
      <td><%= item.updated.strftime("%Y/%m/%d") %></td>
    </tr>
    <% end %>
  </tbody>
</table>

<%= paginate @items if @items.try(:current_page) %>
